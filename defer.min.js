/*! zachleat.com - v2.6.1 - 2022-12-22
* Copyright (c) 2022 Zach Leatherman; @license MIT License */
var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-588046-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();class FilterContainer extends HTMLElement{constructor(){super(),this.attrs={oninit:"oninit",valueDelimiter:"delimiter",leaveUrlAlone:"leave-url-alone",mode:"filter-mode",bind:"data-filter-key",results:"data-filter-results",resultsExclude:"data-filter-results-exclude"},this.classes={enhanced:"filter-container--js",hidden:"filter--hide"}}connectedCallback(){this.init()}init(){this._lookedFor={},this.classList.add(this.classes.enhanced),this.bindEvents(this.formElements),this.hasAttribute(this.attrs.oninit)&&window.setTimeout((()=>{for(let t in this.formElements)this.initFormElements(this.formElements[t]),this.applyFilterForKey(t),this.renderResultCount(!0)}),0)}get valueDelimiter(){return this._valueDelimiter||(this._valueDelimiter=this.getAttribute(this.attrs.valueDelimiter)||","),this._valueDelimiter}get formElements(){if(!this._lookedFor.formElements){let t=`:scope [${this.attrs.bind}]`,e={};for(let r of this.querySelectorAll(t)){let t=r.getAttribute(this.attrs.bind);e[t]||(e[t]=[]),e[t].push(r)}this._formElements=e,this._lookedFor.formElements=!0}return this._formElements}getAllKeys(){return Object.keys(this.formElements)}getElementSelector(t){return`data-filter-${t}`}getKeyFromAttributeName(t){return t.substr("data-filter-".length)}getFilterMode(t){return this.modes||(this.modes={}),this.modes[t]||(this.modes[t]=this.getAttribute(`${this.attrs.mode}-${t}`)),this.modes[t]?this.modes[t]:(this.globalMode||(this.globalMode=this.getAttribute(this.attrs.mode)),this.globalMode)}bindEvents(){this.addEventListener("input",(t=>{let e=t.target.closest(`[${this.attrs.bind}]`);e&&(this.applyFilterForElement(e),requestAnimationFrame((()=>{this.renderResultCount()})))}),!1)}initFormElements(t){for(let e of t){let t=this.getUrlFilterValues(e);for(let r of t){let t=e.getAttribute("type");"INPUT"!==e.tagName||"checkbox"!==t&&"radio"!==t?e.value=r:e.value===r&&(e.checked=!0)}}}getFormElementKey(t){return t.getAttribute(this.attrs.bind)}_getMap(t){let e=[];for(let r of this.formElements[t]){let t=r.getAttribute("type");("INPUT"!==r.tagName||"checkbox"!==t&&"radio"!==t||r.checked)&&e.push(r.value)}this.hasAttribute(this.attrs.leaveUrlAlone)||this.updateUrl(t,e);let r=this.getElementSelector(t),s=`:scope [${r}]`,i=this.querySelectorAll(s),l=new Map;for(let t of Array.from(i)){let s=this.elementIsValid(t,r,e);l.set(t,s)}return l}_applyMapForKey(t,e){if(t)for(let[r,s]of e){let e=`filter-${t}--hide`;s?r.classList.remove(e):r.classList.add(e)}}applyFilterForElement(t){let e=this.getFormElementKey(t);this.applyFilterForKey(e)}applyFilterForKey(t){if(!this.formElements[t][0])return;let e=this._getMap(t);this._applyMapForKey(t,e)}_hasValue(t,e=[],r="any"){if(!e||!e.length||!Array.isArray(e))return!1;if(Array.isArray(t)||(t=[t]),"all"===r){let r=!0;for(let s of e)t.some((t=>t===s))||(r=!1);return r}for(let r of t)if(e.some((t=>t===r)))return!0;return!1}elementIsValid(t,e,r){let s=t.hasAttribute(e);if(s&&(!r.length||!r.join("")))return!0;let i=(t.getAttribute(e)||"").split(this.valueDelimiter),l=this.getKeyFromAttributeName(e),o=this.getFilterMode(l);return!(!s||!this._hasValue(i,r,o))}get resultsCounter(){return this._lookedFor.resultsCounter||(this._results=this.querySelector(`:scope [${this.attrs.results}]`),this._lookedFor.resultsCounter=!0),this._results}getGlobalCount(){let t=this.getAllKeys().map((t=>`:scope [${this.getElementSelector(t)}]`)).join(","),e=this.querySelectorAll(t);return Array.from(e).filter((t=>this.elementIsVisible(t))).filter((t=>!this.elementIsExcluded(t))).length}elementIsVisible(t){for(let e of t.classList)if(e.startsWith("filter-")&&e.endsWith("--hide"))return!1;return!0}elementIsExcluded(t){return t.hasAttribute(this.attrs.resultsExclude)}getLabels(){if(this.resultsCounter){let t=this.resultsCounter.getAttribute(this.attrs.results).split("/");if(2===t.length)return t}return["Result","Results"]}_renderResultCount(t){if(!this.resultsCounter)return;t||(t=this.getGlobalCount());let e=this.getLabels();this.resultsCounter.innerText=`${t} ${1!==t?e[1]:e[0]}`}renderResultCount(t=!1){this.resultsCounter&&(!t&&this.resultsCounter.hasAttribute("aria-live")?(clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this._renderResultCount()}),250)):this._renderResultCount())}getUrlSearchValue(){let t=window.location.search;return t.startsWith("?")?t.substr(1):t}getUrlFilterValues(t){let e=new URLSearchParams(this.getUrlSearchValue()),r=this.getFormElementKey(t);return e.getAll(r)}updateUrl(t,e){let r=new URLSearchParams(this.getUrlSearchValue());if(r.getAll(t).sort().join(",")!==e.slice().sort().join(",")){r.delete(t);for(let s of e)s&&r.append(t,s);let s=window.location.pathname;history.replaceState({},"",`${s}${r.toString().length>0?`?${r}`:""}`)}}}"customElements"in window&&window.customElements.define("filter-container",FilterContainer);